<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Debug Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow: auto;
            border-radius: 5px;
        }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Server Deployment Debug Page</h1>
    <p>This page tests if the server is properly serving basic HTML and JavaScript.</p>
    
    <div class="card">
        <h2>Server Info</h2>
        <div id="server-info"></div>
    </div>
    
    <div class="card">
        <h2>Tests</h2>
        <div id="tests"></div>
        <button id="run-tests">Run Tests</button>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get server info
            const serverInfo = document.getElementById('server-info');
            serverInfo.innerHTML = `
                <p>URL: ${window.location.href}</p>
                <p>User Agent: ${navigator.userAgent}</p>
                <p>Page loaded at: ${new Date().toString()}</p>
            `;
            
            // Setup test runner
            document.getElementById('run-tests').addEventListener('click', runTests);
            
            // Auto-run tests
            setTimeout(runTests, 500);
        });
        
        function runTests() {
            const testsDiv = document.getElementById('tests');
            testsDiv.innerHTML = '<p>Running tests...</p>';
            
            const results = [];
            
            // Test 1: Basic JavaScript Execution
            try {
                results.push({
                    name: 'JavaScript Execution',
                    result: true,
                    message: 'JavaScript is working properly.'
                });
            } catch(e) {
                results.push({
                    name: 'JavaScript Execution',
                    result: false,
                    message: 'JavaScript failed: ' + e.message
                });
            }
            
            // Test 2: LocalStorage Access
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (value === 'value') {
                    results.push({
                        name: 'LocalStorage Access',
                        result: true,
                        message: 'LocalStorage working properly.'
                    });
                } else {
                    throw new Error('Value mismatch');
                }
            } catch(e) {
                results.push({
                    name: 'LocalStorage Access',
                    result: false,
                    message: 'LocalStorage failed: ' + e.message
                });
            }
            
            // Test 3: File access test
            const fileUrls = [
                'redirect.js',
                'js/utils.js',
                'js/main.js'
            ];
            
            let completedTests = 0;
            const totalFileTests = fileUrls.length;
            
            fileUrls.forEach(url => {
                const xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            results.push({
                                name: `File Access: ${url}`,
                                result: true,
                                message: `Successfully loaded ${url}`
                            });
                        } else {
                            results.push({
                                name: `File Access: ${url}`,
                                result: false,
                                message: `Failed to load ${url}: Status ${xhr.status}`
                            });
                        }
                        
                        completedTests++;
                        if (completedTests === totalFileTests) {
                            displayResults();
                        }
                    }
                };
                xhr.open('HEAD', url, true);
                xhr.send();
            });
            
            function displayResults() {
                let html = '<ul>';
                
                results.forEach(test => {
                    const resultClass = test.result ? 'success' : 'error';
                    const resultIcon = test.result ? '✓' : '✗';
                    
                    html += `<li class="${resultClass}">
                        <strong>${test.name}</strong>: ${resultIcon} ${test.message}
                    </li>`;
                });
                
                html += '</ul>';
                
                // Add navigation links
                html += `<p>
                    <a href="index.html">Go to Main App</a> | 
                    <a href="login.html">Go to Login</a> | 
                    <a href="diagnostic.html">Go to Diagnostics</a>
                </p>`;
                
                // Add auto-login link
                html += `<p>
                    <a href="#" onclick="localStorage.setItem('isLoggedIn', 'true'); 
                    localStorage.setItem('userEmail', 'user@example.com'); 
                    alert('Auto-login set'); return false;">Set Auto-Login</a> | 
                    <a href="#" onclick="localStorage.removeItem('isLoggedIn'); 
                    localStorage.removeItem('userEmail'); 
                    alert('Login cleared'); return false;">Clear Login</a>
                </p>`;
                
                testsDiv.innerHTML = html;
            }
            
            // Display initial results
            let html = '<ul>';
            results.forEach(test => {
                const resultClass = test.result ? 'success' : 'error';
                const resultIcon = test.result ? '✓' : '✗';
                
                html += `<li class="${resultClass}">
                    <strong>${test.name}</strong>: ${resultIcon} ${test.message}
                </li>`;
            });
            html += '</ul>';
            html += '<p>Running file access tests...</p>';
            testsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
